using System.Collections.Generic;
using System.Threading.Tasks;
using Rira.Domain.Entities;

namespace Rira.Application.Interfaces
{
    // 🧩 رابط اصلی ریپازیتوری تسک‌ها — ITaskRepository
    // -------------------------------------------------------------------
    // این Interface نقش "درگاه داده‌ها" برای موجودیت TaskEntity را ایفا می‌کند.
    // در معماری Clean ریرا، این رابط میان لایه‌ی Application و Infrastructure قرار دارد
    // و نقطه‌ی ارتباط Handlerها یا سرویس‌های دامنه با دیتابیس از طریق EF Core است.
    //
    // 🎯 هدف:
    //     ▫ تعریف حداقل مجموعه‌ی متدهای CRUD برای مدیریت موجودیت Task.
    //     ▫ اطمینان از جداسازی کامل منطق تجاری (Business Logic) و منطق ذخیره‌سازی (Persistence).
    //     ▫ فراهم‌سازی Mock آسان برای تست‌های واحد (Unit Testing).
    //
    // ⚙️ نکات پیاده‌سازی:
    //     ▫ تمام متدها باید Async باشند → بهبود کارایی در Web API.
    //     ▫ عملیات SoftDelete (غیرفعالسازی منطقی) در Handler یا Service انجام می‌شود، 
    //       نه در این لایه.
    //
    // 🧠 در پروژه‌ی RiRa، نسخه‌ی پیاده‌سازی در مسیر:
    //     Infrastructure/Repositories/TaskRepository.cs
    //     قرار دارد و از EF Core 8 برای ارتباط با DbContext استفاده می‌کند.
    public interface ITaskRepository
    {
        // 🟢 ایجاد رکورد جدید تسک
        // -------------------------------------------------------------------
        // این متد یک TaskEntity جدید را در دیتابیس درج می‌کند.
        // مقدار بازگشتی شناسه‌ی (ID) رکورد درج‌شده است.
        //
        // ⚙️ نکتۀ آموزشی:
        //     - در EF Core معمولاً از context.AddAsync() استفاده می‌شود.
        //     - سپس SaveChangesAsync() برای ثبت نهایی فراخوانی می‌شود.
        Task<int> CreateAsync(TaskEntity entity);

        // 🟡 به‌روزرسانی رکورد موجود
        // -------------------------------------------------------------------
        // متد UpdateAsync مسئول ویرایش موجودیت موجود در بانک اطلاعاتی است.
        // مقدار بازگشتی، ID رکوردی است که با موفقیت به‌روزرسانی شده است.
        //
        // ⚙️ نکتۀ آموزشی:
        //     - Update صرفاً باید فیلدهای مشخص‌شده را تغییر دهد.
        //     - تنظیم UpdatedAt در Handler انجام می‌شود، نه در Repository.
        Task<int> UpdateAsync(TaskEntity entity);

        // 🔵 دریافت یک تسک بر اساس شناسه
        // -------------------------------------------------------------------
        // این متد وظیفۀ یافتن رکورد بر اساس شناسه (ID) را دارد.
        // اگر رکوردی پیدا نشود، مقدار بازگشتی null خواهد بود.
        //
        // ⚙️ در پیاده‌سازی EF Core:
        //     از context.Tasks.AsNoTracking().FirstOrDefaultAsync(x => x.Id == id)
        //     استفاده می‌شود تا از بارگیری اضافی جلوگیری شود.
        Task<TaskEntity> GetByIdAsync(int id);

        // 🟣 دریافت تمام تسک‌ها (به‌طور پیش‌فرض فقط فعال‌ها)
        // -------------------------------------------------------------------
        // این متد برای گرفتن لیستی از تمامی TaskEntityها طراحی شده است.
        // در معماری ریرا رکوردهای حذف‌شده (SoftDeleted) معمولاً فیلتر می‌شوند.
        //
        // ⚙️ نکته:
        //     در پیاده‌سازی باید where IsDeleted == false اعمال شود.
        Task<List<TaskEntity>> GetAllAsync();

        // 🔴 حذف سخت رکورد از دیتابیس (Rare Use)
        // -------------------------------------------------------------------
        // این متد برای حذف فیزیکی داده از دیتابیس طراحی شده اما در ریرا به‌صورت پیش‌فرض
        // استفاده نمی‌شود، زیرا حذف منطقی (SoftDelete) معماری بهتری برای داده‌های حساس فراهم می‌کند.
        //
        // ⚙️ مثال:
        //     در حالت خاص مانند پاک‌سازی داده‌های آزمایشی (seed/test) می‌توان از آن استفاده کرد.
        Task<bool> DeleteAsync(int id);
    }

    // ===========================================================================================
    // 📘 خلاصه آموزشی (RiraDocs Teaching Edition)
    // -------------------------------------------------------------------------------------------
    // 🔹 جایگاه ITaskRepository:
    //     ▫ در لایه‌ی Application و زیرپوشه‌ی Interfaces قرار دارد.
    //     ▫ به‌عنوان قرارداد ارتباطی با لایه‌ی Persistence (EF Core) عمل می‌کند.
    //
    // 🔹 پیاده‌سازی مرتبط:
    //     ▫ کلاس TaskRepository در لایه‌ی Infrastructure 
    //       از طریق IAppDbContext با DbContext ارتباط می‌گیرد.
    //
    // 🔹 فلسفه‌ی معماری Clean:
    //     ▫ Application باید تنها از Interface آگاه باشد، نه از EFCore یا دیتابیس.
    //     ▫ این امر باعث جدایش وابستگی‌ها (Dependency Inversion Principle) می‌شود.
    //
    // 🔹 نکات تست‌پذیری:
    //     ▫ می‌توان نسخه‌ی FakeTaskRepository را برای تست واحد ساخت.
    //     ▫ در تست‌ها می‌توان رفتار متدها را شبیه‌سازی کرد.
    //
    // 🔹 وابستگی به Domain:
    //     ▫ از TaskEntity در Rira.Domain.Entities استفاده می‌کند.
    //     ▫ هیچ DTO یا مدل Application نباید در این‌جا حضور داشته باشد.
    //
    // 🔹 تگ انتشار RiRaDocs:
    //     RiraDocs-v2025.11.4-Stable-Final-Fixed
    // ===========================================================================================
}
