using System;

namespace Rira.Application.Common.Exceptions
{
    /// <summary>
    /// ✳️ Exception مخصوص خطاهای منطقی سطح کسب‌و‌کار (Business Rules)
    /// --------------------------------------------------------------
    /// این نوع خطا در زمانی استفاده می‌شود که داده یا عملیات
    /// برخلاف یکی از قوانین تجاری تعریف‌شده در سیستم عمل کند.
    /// 
    /// 🎓 مفهوم آموزشی (RiraDocs Teaching Edition):
    ///  - خطاهای این سطح مرتبط با منطق تجاری هستند نه سیستم یا زیرساخت.
    ///  - مثلاً وقتی کاربر بخواهد وظیفه‌ای ایجاد کند که وضعیت غیرمجاز دارد،
    ///    Handler باید یک <see cref="BusinessException"/> پرتاب کند.
    ///  - در معماری Clean Architecture، این دسته از Exceptionها مستقل از UI و DB هستند
    ///    و فقط قواعد کسب‌و‌کار را نمایش می‌دهند.
    /// </summary>
    public class BusinessException : Exception
    {
        /// <summary>
        /// 🔹 کد خطای اختیاری جهت دسته‌بندی انواع خطاهای منطقی.
        /// می‌تواند برای ثبت در لاگ‌، نمایش در پاسخ HTTP یا گزارش‌های سیستمی استفاده شود.
        /// </summary>
        public string? ErrorCode { get; }

        // ======================================================================================================
        // 🔹 سازنده فقط با پیام
        // ------------------------------------------------------------------------------------------------------
        /// <summary>
        /// 📌 سازنده‌ای ساده که فقط پیام خطا را دریافت می‌کند.
        /// مورد استفاده در زمانی‌که نیاز به کد خطا یا Exception داخلی نیست.
        /// مثال:
        /// <code>throw new BusinessException("این کارمند فعال نیست");</code>
        /// </summary>
        public BusinessException(string message)
            : base(message)
        {
            ErrorCode = null;
        }

        // ======================================================================================================
        // 🔹 سازنده با پیام و کد خطا
        // ------------------------------------------------------------------------------------------------------
        /// <summary>
        /// ⚙️ سازنده‌ای که علاوه بر پیام خطا، کد خطا نیز دریافت می‌کند.
        /// به‌صورت خودکار پیام کامپوزیت می‌سازد تا در گزارش‌ها خواناتر باشد.
        /// مثال:
        /// <code>throw new BusinessException("دسترسی غیرمجاز", "BUS403");</code>
        /// </summary>
        public BusinessException(string message, string? errorCode)
            : base(errorCode is not null && errorCode != string.Empty
                   ? $"{message} (کد خطا: {errorCode})"
                   : message)
        {
            ErrorCode = errorCode;
        }

        // ======================================================================================================
        // 🔹 سازنده با پیام، کد خطا و استثناء داخلی
        // ------------------------------------------------------------------------------------------------------
        /// <summary>
        /// ⚠️ سازنده‌ای برای زمانی‌که Exception دیگر علت اصلی خطا باشد.
        /// معمولاً در لایه Application هنگام مدیریت خطاهای زیرساختی استفاده می‌شود تا منبع خطا حفظ گردد.
        /// مثال:
        /// <code>throw new BusinessException("خطا در بروزرسانی وضعیت", "BUS501", ex);</code>
        /// </summary>
        public BusinessException(string message, string? errorCode, Exception? innerException)
            : base(errorCode is not null && errorCode != string.Empty
                   ? $"{message} (کد خطا: {errorCode})"
                   : message, innerException)
        {
            ErrorCode = errorCode;
        }

        // ===========================================================================================
        // 📘 خلاصه آموزشی (RiraDocs Teaching Edition)
        // -------------------------------------------------------------------------------------------
        // این کلاس نماینده‌ی خطاهای domain-level است.
        // در Handlerها پرتاب می‌شود تا توسط MediatR یا Middleware اصلی، به پاسخ استاندارد تبدیل شود.
        // نقش اصلی آن جدا کردن منطق تجاری از خطاهای زیرساختی و قابل‌پیش‌بینی کردن مسیر‌های شکست عملیات است.
        // هیچ تغییر اجرایی انجام نشده – فقط توضیحات فارسی برای آموزش توسعه‌دهندگان ریرا افزوده شده.
        // ===========================================================================================
    }
}
