using System.Globalization;

namespace Rira.Application.Utilities
{
    // 🧭 کلاس کمکی تاریخ شمسی (DateHelper)
    // ===============================================================================
    // این کلاس ابزار (Utility Class) ساده اما کلیدی در لایه‌ی Application است
    // که وظیفه‌ی یکسان‌سازی و تولید رشته‌های تاریخ شمسی در سراسر پروژه RiRa را برعهده دارد.
    //
    // 🎯 اهداف طراحی:
    //     ▫ ارائه‌ی خروجی شمسی سازگار با میدان‌های متنی (string-based dates)
    //       مانند CreatedAt, UpdatedAt در موجودیت‌ها.
    //     ▫ جلوگیری از پراکندگی تبدیل تاریخ در بخش‌های مختلف پروژه.
    //     ▫ ارائه‌ی فرمت استاندارد "yyyy/MM/dd" مطابق معماری داده‌ی RiRa.
    //
    // ⚙️ سناریوهای استفاده:
    //     ▫ هنگام ایجاد یا بروزرسانی تسک‌ها در TaskService.
    //     ▫ در Handlerهایی که نیاز به نمایش تاریخ قابل خواندن برای کاربر دارند.
    //
    // 🔹 نکته طراحی RiRaDocs:
    //     در پروژه‌ی RiRa تمام تاریخ‌ها (حتی در دیتابیس) به‌صورت رشته ذخیره می‌شوند
    //     تا ناسازگاری میان تقویم میلادی و شمسی از بین برود.
    public static class DateHelper
    {
        // ============================================================
        // 🔁 ToPersianDateString(DateTime date)
        // ------------------------------------------------------------
        // وظیفه: تبدیل تاریخ میلادی به رشته‌ای از نوع شمسی.
        // ============================================================
        //
        // 🧠 توضیح آموزشی:
        //   - کلاس System.Globalization.PersianCalendar برای استخراج اجزای تاریخ شمسی به‌کار می‌رود.
        //   - متد GetYear / GetMonth / GetDayOfMonth مقدارهای معادل را برمی‌گردانند.
        //   - در نهایت خروجی با فرمت دقیق "yyyy/MM/dd" ساخته می‌شود.
        //
        // ⚙️ مثال کاربرد:
        //     DateHelper.ToPersianDateString(DateTime.Now)
        //     ➜ "1404/07/19"
        //
        // 🔸 نکته مهم:
        //     برای پایداری خروجی در کل سیستم از padding (00/0000) استفاده شده است.
        public static string ToPersianDateString(DateTime date)
        {
            var pc = new PersianCalendar();
            return $"{pc.GetYear(date):0000}/{pc.GetMonth(date):00}/{pc.GetDayOfMonth(date):00}";
        }

        // ============================================================
        // 🕒 GetPersianNow()
        // ------------------------------------------------------------
        // وظیفه: بازگرداندن تاریخ فعلی سیستم (اکنون) به‌صورت شمسی.
        // ============================================================
        //
        // 📘 توضیح:
        //   این متد تاریخ فعلی سیستم را گرفته و معادل شمسی آن را به کمک متد بالا بازمی‌گرداند.
        //   در کلاس‌های TaskService و سایر سرویس‌ها برای پرکردن
        //   فیلدهای CreatedAt و UpdatedAt استفاده می‌شود.
        //
        // ⚙️ مثال استفاده:
        //     entity.CreatedAt = DateHelper.GetPersianNow();
        //     ➜ "1404/08/13"
        public static string GetPersianNow()
        {
            return ToPersianDateString(DateTime.Now);
        }
    }

    // ===========================================================================================
    // 📘 خلاصه آموزشی (RiraDocs Teaching Edition)
    // -------------------------------------------------------------------------------------------
    // 🔹 مفهوم:
    //     DateHelper تبدیل تاریخ بین میلادی و شمسی را استاندارد می‌سازد و
    //     برای تمام مقادیر زمانی (CreatedAt, UpdatedAt و ...) در RiRa به‌کار می‌رود.
    //
    // 🔹 کاربرد در پروژه:
    //     ▫ Serviceها (مثل TaskService) جهت زمان‌گذاری خودکار.
    //     ▫ CQRS Handlers برای نمایش تاریخ خوانا در خروجی.
    //
    // 🔹 نکات طراحی کلیدی:
    //     ▫ استفاده از System.Globalization.PersianCalendar (بدون وابستگی به ICU).
    //     ▫ فرمت ثابت "yyyy/MM/dd" برای تضمین سازگاری در Swagger و DB‌.
    //     ▫ ذخیره‌سازی رشته‌ای به‌جای DateTime برای جلوگیری از مشکلات TimeZone.
    //
    // 🔹 اصول رعایت‌شده:
    //     ▫ Single Responsibility Principle — یک وظیفه مشخص دارد (تبدیل تاریخ).
    //     ▫ عدم وابستگی به محیط (Static Utility - بدون DI).
    //     ▫ استاتیک و بدون State جهت Thread Safety.
    //
    // 🔹 تگ انتشار RiRaDocs:
    //     RiraDocs-v2025.11.4-Stable-Final-Fixed
    // ===========================================================================================
}
