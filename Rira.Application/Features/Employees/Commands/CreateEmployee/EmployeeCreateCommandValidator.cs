using FluentValidation;

namespace Rira.Application.Features.Employees.Commands.CreateEmployee
{
    // 🔍 اعتبارسنجی داده‌های فرمان ایجاد کارمند (EmployeeCreateCommandValidator)
    // ------------------------------------------------------------
    // این کلاس وظیفه دارد قبل از اجرای منطق اصلی در Handler، تمامی داده‌های ورودی Command را بررسی کند.
    // اعتبارسنجی با استفاده از کتابخانه FluentValidation انجام می‌شود که یکی از بهترین ابزارها برای جداسازی منطق بررسی داده‌ها از منطق تجاری است.
    // هر Rule تعریف‌شده مستقل از بقیه اجرا می‌شود و در صورت تخلف، پیام خطای مناسب را برمی‌گرداند.
    public class EmployeeCreateCommandValidator : AbstractValidator<EmployeeCreateCommand>
    {
        // سازنده‌ی کلاس، تمامی قواعد اعتبارسنجی (Rules) را تعریف می‌کند.
        public EmployeeCreateCommandValidator()
        {
            // ✅ Rule برای نام کوچک (FirstName)
            // ------------------------------------------------------------
            // الزامی بودن مقدار و محدودیت طول تا ۵۰ کاراکتر.
            RuleFor(x => x.FirstName)
                .NotEmpty().WithMessage("نام کارمند نباید خالی باشد.")
                .MaximumLength(50).WithMessage("نام کارمند نمی‌تواند بیشتر از ۵۰ کاراکتر باشد.");

            // ✅ Rule برای نام خانوادگی (LastName)
            // ------------------------------------------------------------
            // مشابه نام کوچک، بررسی خالی نبودن و محدودیت طول.
            RuleFor(x => x.LastName)
                .NotEmpty().WithMessage("نام خانوادگی کارمند نباید خالی باشد.")
                .MaximumLength(50).WithMessage("نام خانوادگی نمی‌تواند بیشتر از ۵۰ کاراکتر باشد.");

            // ✅ Rule برای شماره موبایل (MobileNumber)
            // ------------------------------------------------------------
            // بررسی خالی نبودن و فرمت عددی دقیق ۱۱ رقمی.
            // برای جلوگیری از ورود کاراکترهای غیرعددی یا طول نامعتبر.
            RuleFor(x => x.MobileNumber)
                .NotEmpty().WithMessage("شماره موبایل اجباری است.")
                .Matches(@"^\d{11}$").WithMessage("شماره موبایل باید دقیقاً شامل ۱۱ رقم باشد.");

            // ✅ Rule برای ایمیل (Email)
            // ------------------------------------------------------------
            // فقط زمانی بررسی می‌شود که مقدار وارد شده باشد (When شرطی).
            // از متد EmailAddress برای بررسی فرمت ایمیل استفاده می‌شود.
            RuleFor(x => x.Email)
                .EmailAddress().When(x => !string.IsNullOrWhiteSpace(x.Email))
                .WithMessage("فرمت ایمیل معتبر نیست.");

            // ✅ Rule برای تاریخ تولد شمسی (BirthDatePersian)
            // ------------------------------------------------------------
            // بررسی فرمت الگوی yyyy/MM/dd با استفاده از Regular Expression.
            RuleFor(x => x.BirthDatePersian)
                .Matches(@"^\d{4}/\d{2}/\d{2}$")
                .WithMessage("تاریخ تولد باید به‌صورت yyyy/MM/dd وارد شود.");

            // ✅ Rule برای سطح تحصیلات (EducationLevel)
            // ------------------------------------------------------------
            // مقدار Enum نباید صفر یا کمتر از آن باشد.
            // این بررسی تضمین می‌کند که یکی از سطح‌های معتبر انتخاب شده باشد.
            RuleFor(x => (int)x.EducationLevel)
                .GreaterThan(0).WithMessage("سطح تحصیلات معتبر نیست.");
        }

        // ===========================================================================================
        // 📘 خلاصه آموزشی (RiraDocs Teaching Edition)
        // -------------------------------------------------------------------------------------------
        // 🔹 این کلاس بخشی از لایه Application است و در معماری CQRS وظیفه دارد صحت داده‌های Command را بررسی کند.
        // 🔹 استفاده از FluentValidation باعث می‌شود که منطق اعتبارسنجی از Handler جدا باشد، افزایش تست‌پذیری و خوانایی کد.
        // 🔹 RuleFor برای هر ویژگی (Property) تعریف می‌شود و با متدهای کمکی مثل NotEmpty، Matches، MaximumLength و ... قابل ترکیب است.
        // 🔹 خروجی همه Ruleها درصورت تخلف از طریق Middleware اختصاصی در سطح API هندل می‌شود.
        // 🔹 این Validator به‌طور خودکار توسط MediatR قبل از رسیدن Command به Handler اجرا می‌شود.
        // 🔹 هیچ منطق تجاری یا پردازش دیتابیس درون Validator قرار ندارد — فقط بررسی فرمت و الزامات اولیه است.
        // 🔹 این ساختار باعث می‌شود مرحله‌ی اعتبارسنجی داده به‌صورت جداگانه تست‌پذیر و توسعه‌پذیر بماند.
        // ===========================================================================================
    }
}
