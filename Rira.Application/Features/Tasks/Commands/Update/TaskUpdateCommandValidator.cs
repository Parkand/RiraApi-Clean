using FluentValidation;

namespace Rira.Application.Features.Tasks.Commands.Update
{
    // 🧩 اعتبارسنج (Validator) برای فرمان به‌روزرسانی تسک — TaskUpdateCommandValidator
    // -------------------------------------------------------------------
    // این کلاس مسئول بررسی صحت داده‌های ورودی در فرآیند "ویرایش تسک" است.
    //
    // 📌 جایگاه در معماری:
    //     ▫ در الگوی Clean Architecture، اعتبارسنجی‌ها در لایه Application انجام می‌شوند.
    //     ▫ این کلاس پیش از اجرای Handler (TaskUpdateCommandHandler) توسط MediatR و FluentValidation اجرا می‌شود.
    //
    // ⚙️ هدف:
    //     جلوگیری از ورود داده‌های نامعتبر به منطق بیزنسی و پایگاه داده.
    //     مثل شناسهٔ نامعتبر، عنوان خالی یا طولانی، تاریخ با فرمت اشتباه.
    //
    // 📚 ابزار مورد استفاده:
    //     FluentValidation — یک کتابخانه محبوب برای تعریف قواعد اعتبارسنجی خوانا و تمیز.
    //
    // 🧠 نکته:
    //     در RiRa، Validatorها با Commandها قرینه هستند (Create, Update, Delete Commands).
    //     هر Command دقیقاً یک Validator با قواعد اختصاصی دارد.
    public class TaskUpdateCommandValidator : AbstractValidator<TaskUpdateCommand>
    {
        // ⚙️ سازنده کلاس — تعریف قواعد اعتبارسنجی
        // -------------------------------------------------------------------
        // در FluentValidation، همه‌ی قواعد درون سازنده کلاس تعریف می‌شوند.
        // این قواعد هنگام ارسال Command توسط MediatR اجرا می‌شوند.
        public TaskUpdateCommandValidator()
        {
            // 🔹 قاعده ۱: اعتبار شناسه (Id)
            // -------------------------------------------------------------------
            // شناسه باید عددی مثبت باشد.
            RuleFor(x => x.Id)
                .GreaterThan(0)
                .WithMessage("شناسه تسک معتبر نیست.");

            // 🔹 قاعده ۲: اعتبار عنوان (Title)
            // -------------------------------------------------------------------
            //   - نباید خالی باشد.
            //   - بیشینه طول 150 کاراکتر مجاز است.
            RuleFor(x => x.Title)
                .NotEmpty().WithMessage("عنوان الزامی است.")
                .MaximumLength(150);

            // 🔹 قاعده ۳: اعتبار توضیحات (Description)
            // -------------------------------------------------------------------
            // توضیحات اختیاری است اما اگر داده شود نباید از 500 کاراکتر بیشتر باشد.
            RuleFor(x => x.Description)
                .MaximumLength(500);

            // 🔹 قاعده ۴: اعتبار تاریخ سررسید (DueDate)
            // -------------------------------------------------------------------
            // باید با فرمت yyyy/MM/dd وارد شود، مطابق استاندارد پروژه RiRa.
            RuleFor(x => x.DueDate)
                .Matches(@"^\d{4}/\d{2}/\d{2}$")
                .WithMessage("فرمت تاریخ باید yyyy/MM/dd باشد.");
        }

        // ===========================================================================================
        // 📘 خلاصه آموزشی (RiraDocs Teaching Edition)
        // -------------------------------------------------------------------------------------------
        // 🔹 مسئولیت کلاس:
        //     ▫ بررسی صحت و سازگاری داده‌های ورودی برای Command مربوط به Update.
        // 🔹 جایگاه در جریان:
        //     Controller → sends Command → Validator checks → Handler executes.
        //
        // 🔹 نکته معماری:
        //     ▫ Validatorها از لایه Application جدا می‌شوند تا منطق استنتاجی از منطق ورودی مستقل بماند.
        //     ▫ اگر ورودی نامعتبر باشد، این Validator خطا تولید کرده و Handler اصلاً اجرا نمی‌شود.
        //
        // 🔹 تست‌پذیری:
        //     ▫ می‌توان هر Rule را جداگانه تست کرد (Unit Test).
        //     ▫ مثلاً بررسی Id منفی، Title خالی، یا تاریخ نادرست.
        //
        // 🔹 پوشش داده‌های معتبر:
        //     ▫ Id > 0
        //     ▫ Title بین 1 تا 150 کاراکتر
        //     ▫ Description ≤ 500
        //     ▫ DueDate با فرمت yyyy/MM/dd
        //
        // 🔹 هیچ تغییر اجرایی در کد اعمال نشده — فقط توضیحات آموزشی فارسی اضافه شده‌اند.
        // ===========================================================================================
    }
}
