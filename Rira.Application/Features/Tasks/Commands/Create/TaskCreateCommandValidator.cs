using FluentValidation;

namespace Rira.Application.Features.Tasks.Commands.Create
{
    // 🧩 کلاس بررسی اعتبار داده‌ها هنگام ایجاد تسک جدید
    // -------------------------------------------------------------------
    // این کلاس وظیفه دارد قبل از رسیدن Command به Handler، داده‌های ورودی را بررسی کند.
    // در معماری CQRS، اعتبارسنجی بخش مهمی از pipeline است تا از ورود داده‌های نادرست جلوگیری شود.
    //
    // 📍 مکان در ساختار پروژه:
    //     Application → Features → Tasks → Commands → Create → TaskCreateCommandValidator.cs
    //
    // 🧠 نقش اصلی:
    //     ▫ اطمینان از معتبر بودن داده‌های ورودی (Title, Description, DueDate)
    //     ▫ اعمال پیام‌های خطا به زبان فارسی برای سهولت در گزارش‌گیری سمت UI
    //
    // 📦 منطق کلی:
    //     FluentValidation تمامی قواعد اعتبارسنجی را به صورت داخلی تعریف و بررسی می‌کند.
    //     اگر هیچ خطایی وجود نداشته باشد، Command ادامهٔ مسیر MediatR را طی کرده و به Handler می‌رسد.
    public class TaskCreateCommandValidator : AbstractValidator<TaskCreateCommand>
    {
        public TaskCreateCommandValidator()
        {
            // 📝 بررسی فیلد Title — عنوان تسک
            // ----------------------------------------------------------------
            // این قانون تضمین می‌کند که عنوان تسک خالی نباشد و طول آن از ۱۵۰ کاراکتر بیشتر نشود.
            // عنوان نقش کلیدی در نمایش وظایف دارد، بنابراین باید کوتاه، واضح و اجباری باشد.
            RuleFor(x => x.Title)
                .NotEmpty().WithMessage("عنوان تسک الزامی است.")       // قانون: نباید خالی باشد
                .MaximumLength(150).WithMessage("حداکثر طول عنوان ۱۵۰ کاراکتر است."); // محدودیت طول

            // 📄 بررسی فیلد Description — توضیحات اختیاری
            // ----------------------------------------------------------------
            // توضیحات می‌تواند خالی باشد، اما اگر وجود داشته باشد نباید از ۵۰۰ کاراکتر فراتر برود.
            RuleFor(x => x.Description)
                .MaximumLength(500).WithMessage("توضیحات نباید بیش از ۵۰۰ کاراکتر باشد.");

            // ⏰ بررسی فیلد DueDate — تاریخ سررسید
            // ----------------------------------------------------------------
            // قانون: باید وارد شود و فرمت آن دقیقاً به صورت yyyy/MM/dd باشد.
            // این بررسی با regex انجام می‌شود تا از کژفرمت (مثلاً MM-dd-yyyy یا تاریخ ناقص) جلوگیری کند.
            RuleFor(x => x.DueDate)
                .NotEmpty().WithMessage("تاریخ سررسید الزامی است.")                // نباید خالی باشد
                .Matches(@"^\d{4}/\d{2}/\d{2}$")                                   // الگوی مورد انتظار
                .WithMessage("فرمت تاریخ باید yyyy/MM/dd باشد.");                  // پیام خطای فرمت
        }

        // ===========================================================================================
        // 📘 خلاصه آموزشی (RiraDocs Teaching Edition)
        // -------------------------------------------------------------------------------------------
        // 🔹 نقش Validator در مسیر CQRS:
        //     ▫ اجرای مرحله‌ای قبل از Handler برای جلوگیری از داده‌های نامعتبر.
        //     ▫ اگر خطایی وجود داشته باشد، Handler هرگز اجرا نمی‌شود.
        //
        // 🔹 ارتباط با سایر اجزا:
        //     [Controller] → Command(TaskCreateCommand)
        //                → Validator(TaskCreateCommandValidator)
        //                → Handler(TaskCreateCommandHandler)
        //                → پایگاه داده (DbContext)
        //
        // 🔹 مزایا:
        //     ▫ افزایش کیفیت داده‌ها و کاهش خطاهای منطقی در سطح Model.
        //     ▫ پیام‌های فارسی باعث سهولت تست و نمایش سمت کلاینت می‌شوند.
        //
        // 🔹 نکات آینده‌نگر:
        //     ▫ می‌توان قوانین اضافی مانند بررسی تکراری بودن عنوان یا
        //       اعتبار DueDate نسبت به تاریخ جاری را نیز اضافه کرد.
        //
        // 🔹 نکته آزمون:
        //     در تست واحد، می‌توان نمونه‌های نامعتبر Command را تزریق کرد
        //     و اطمینان یافت کتابخانه FluentValidation آنها را رد می‌کند.
        //
        // 🔹 هیچ تغییری در عملکرد کد داده نشده — فقط توضیحات آموزشی فارسی افزوده شدند.
        // ===========================================================================================
    }
}
